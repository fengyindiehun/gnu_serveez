@c -*-texinfo-*-
@c
@c This file includes the documentation about the guile servers. It is
@c included by `serveez.texi'.
@c

This section describes the guile interface of serveez meant to provide
the ability to exceptionally write servers with guile. Of course you could
do this without any help of serveez, but it makes it a lot easier. The
guile interface of serveez reduces the guile implementation of an Internet
server to a simple data processor.

@subsubsection Special data types

Serveez extends guile by various new data types which represent internal
data structures of serveez's core API.

@itemize @bullet
@item @code{#<svz-servertype>}
represent a server type.
@item @code{#<svz-server>}
represents a server (an instance of a server type).
@item @code{#<svz-socket>}
represents a socket structure.
@end itemize

@subsubsection Passing binary data

The new binary data type (i.e. @code{#<binary>}) provides access to any
kind of unstructured data. It manages data exchange between guile and serveez
and the other way around. There are some converter functions for strings 
and lists which help to process this binary data in a more complex (guile'ish) 
way.

BINARY->STRING_DEFUN
STRING->BINARY_DEFUN
BINARY?_DEFUN
LIST->BINARY_DEFUN
BINARY->LIST_DEFUN
BINARY-SEARCH_DEFUN
BINARY-SET!_DEFUN
BINARY-REF_DEFUN
BINARY-LENGTH_DEFUN
BINARY-CONCAT_DEFUN
BINARY-SUBSET_DEFUN

@subsubsection Server definition

In order to setup a new server type you use the procedure 
@code{(define-servertype!)}. This procedure takes one argument which must be
a associative list specifying the server type in detail. There are 
optional and mandatory elements you can setup in this alist. The following
example shows the overall syntax of this procedure:

@lisp
(define-servertype! '(

  ;; Mandatory: server type prefix for later use in (define-server!)
  (prefix          . "foo")

  ;; Mandatory: server type description
  (description     . "guile foo server")

  ;; Mandatory for TCP and PIPE servers: protocol detection
  (detect-proto    . foo-detect-proto)

  ;; Optional: global server type initialization
  (global-init     . foo-global-init)

  ;; Optional: server instance initialization
  (init            . foo-init)

  ;; Optional: server instance finalization
  (finalize        . foo-finalize)

  ;; Optional: global server type finalization
  (global-finalize . foo-global-finalize)

  ;; Mandatory for TCP and PIPE servers: socket connnection
  (connect-socket  . foo-connect-socket)

  ;; Optional: server instance info
  (info-server     . foo-info-server)

  ;; Mandatory: server type configuration
  (configuration   . (

    ;; The server configuration is an alist (associative list) again. Each
    ;; item consist of an item name and a list describing the item itself.
    ;; Syntax: (key . (type defaultable default))
    (foo-integer       . (integer  #t 0))
    (foo-integer-array . (intarray #t (1 2 3 4 5)))
    (foo-string        . (string   #t "default-foo-string"))
    (foo-string-array  . (strarray #t ("guile" "foo" "server")))
    (foo-hash          . (hash     #t (("foo" . "bar"))))
    (foo-port          . (portcfg  #t foo-port))
    (foo-boolean       . (boolean  #t #t))
  ))))
@end lisp

DEFINE-SERVERTYPE!_DEFUN

@subsubsection Predefined procedures

SVZ:SOCK:CHECK-REQUEST_DEFUN
SVZ:SOCK:HANDLE-REQUEST_DEFUN
SVZ:SOCK:BOUNDARY_DEFUN
SVZ:SOCK:PRINT_DEFUN
SVZ:SOCK:RECEIVE-BUFFER_DEFUN
SVZ:SOCK:DATA_DEFUN
SVZ:SERVER:CONFIG-GET_DEFUN
